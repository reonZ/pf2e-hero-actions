{"version":3,"file":"main.js","mappings":"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","sources":["webpack:///../../../../foundryVTT-projects/@utils/module.ts","webpack:///../../../../foundryVTT-projects/@utils/foundry/notification.ts","webpack:///../../../../foundryVTT-projects/@utils/foundry/localize.ts","webpack:///../../../../foundryVTT-projects/@utils/foundry/module.ts","webpack:///../../../../foundryVTT-projects/@utils/foundry/path.ts","webpack:///../../../../foundryVTT-projects/@utils/foundry/settings.ts","webpack:///../../../../foundryVTT-projects/@utils/socket.ts","webpack:///../../../../foundryVTT-projects/@utils/foundry/flags.ts","webpack:///../../../../foundryVTT-projects/@utils/foundry/uuid.ts","webpack:///./src/trade.ts","webpack:///./src/apps/trade.ts","webpack:///../../../../foundryVTT-projects/@utils/foundry/actor.ts","webpack:///../../../../foundryVTT-projects/@utils/foundry/user.ts","webpack:///./src/actions.ts","webpack:///./src/api.ts","webpack:///./src/sheet.ts","webpack:///./src/main.ts"],"sourcesContent":["export let MODULE_ID = ''\r\nexport let TYPE = 'module'\r\n\r\nexport function setModuleID(id: string, isSystem = false) {\r\n    if (!MODULE_ID) MODULE_ID = id\r\n    TYPE = isSystem ? 'system' : 'module'\r\n}\r\n","import { localize } from '@utils/foundry/localize'\r\n\r\nexport type NotifyArgs = [str: string, arg1?: boolean | Record<string, string | number | boolean>, arg2?: boolean]\r\n\r\nfunction notify(\r\n    str: string,\r\n    arg1?: 'warning' | 'info' | 'error' | boolean | Record<string, string | number | boolean>,\r\n    arg2?: boolean | Record<string, string | number | boolean>,\r\n    arg3?: boolean\r\n) {\r\n    const type = typeof arg1 === 'string' ? arg1 : 'info'\r\n    const data = typeof arg1 === 'object' ? arg1 : typeof arg2 === 'object' ? arg2 : undefined\r\n    const permanent = typeof arg1 === 'boolean' ? arg1 : typeof arg2 === 'boolean' ? arg2 : arg3 ?? false\r\n\r\n    ui.notifications.notify(localize(str, data), type, { permanent })\r\n}\r\n\r\nexport function warn(...args: NotifyArgs) {\r\n    const [str, arg1, arg2] = args\r\n    notify(str, 'warning', arg1, arg2)\r\n}\r\n\r\nexport function info(...args: NotifyArgs) {\r\n    const [str, arg1, arg2] = args\r\n    notify(str, 'info', arg1, arg2)\r\n}\r\n\r\nexport function error(...args: NotifyArgs) {\r\n    const [str, arg1, arg2] = args\r\n    notify(str, 'error', arg1, arg2)\r\n}\r\n","import { MODULE_ID } from '@utils/module'\r\nimport { warn, NotifyArgs, info, error } from '@utils/foundry/notification'\r\n\r\nexport type LocalizeArgs = [key: string, data?: Record<string, string | number | boolean>]\r\n\r\nexport function localize(...args: LocalizeArgs) {\r\n    let [key, data] = args\r\n    key = `${MODULE_ID}.${key}`\r\n    if (data) return game.i18n.format(key, data)\r\n    return game.i18n.localize(key)\r\n}\r\n\r\nexport function hasLocalization(key: string) {\r\n    return game.i18n.has(`${MODULE_ID}.${key}`, false)\r\n}\r\n\r\nexport function localizePath(key: string) {\r\n    return `${MODULE_ID}.${key}`\r\n}\r\n\r\nexport function localizeTemplate(key: string, { hash }: { hash: Record<string, string> }) {\r\n    return localize(`${key}`, hash)\r\n}\r\n\r\nexport function subLocalize(subKey: string) {\r\n    const fn = (...args: LocalizeArgs) => localize(`${subKey}.${args[0]}`, args[1])\r\n\r\n    Object.defineProperties(fn, {\r\n        warn: {\r\n            value: (...args: NotifyArgs) => warn(`${subKey}.${args[0]}`, args[1], args[2]),\r\n            enumerable: false,\r\n            configurable: false,\r\n        },\r\n        info: {\r\n            value: (...args: NotifyArgs) => info(`${subKey}.${args[0]}`, args[1], args[2]),\r\n            enumerable: false,\r\n            configurable: false,\r\n        },\r\n        error: {\r\n            value: (...args: NotifyArgs) => error(`${subKey}.${args[0]}`, args[1], args[2]),\r\n            enumerable: false,\r\n            configurable: false,\r\n        },\r\n        has: {\r\n            value: (key: string) => hasLocalization(`${subKey}.${key}`),\r\n            enumerable: false,\r\n            configurable: false,\r\n        },\r\n        path: {\r\n            value: (key: string) => localizePath(`${subKey}.${key}`),\r\n            enumerable: false,\r\n            configurable: false,\r\n        },\r\n        template: {\r\n            value: (key: string, { hash }: { hash: Record<string, string> }) => fn(key, hash),\r\n            enumerable: false,\r\n            configurable: false,\r\n        },\r\n    })\r\n\r\n    return fn as ((...args: LocalizeArgs) => string) & {\r\n        warn: (...args: NotifyArgs) => void\r\n        info: (...args: NotifyArgs) => void\r\n        error: (...args: NotifyArgs) => void\r\n        has: (key: string) => boolean\r\n        path: (key: string) => string\r\n        template: (key: string, options: { hash: Record<string, string> }) => string\r\n    }\r\n}\r\n","import { MODULE_ID } from '@utils/module'\r\n\r\ntype OwnModule = 'anonymous' | 'idleuh' | 'pf2e-hero-actions' | 'pf2e-dailies'\r\n\r\ntype ReturnedModule<TApi extends ModuleApi = ModuleApi> = Module<TApi> | undefined\r\ntype ReturnedModuleApi<TApi extends Record<string, any>> = Module<TApi>['api'] | undefined\r\n\r\nexport function getModule<T extends ModuleApi = ModuleApi>(id: string | OwnModule) {\r\n    return game.modules.get(id) as ReturnedModule<T>\r\n}\r\n\r\nexport function getCurrentModule<TApi extends ModuleApi = ModuleApi>() {\r\n    return getModule(MODULE_ID) as Module<TApi>\r\n}\r\n\r\nexport function getModuleApi<TApi extends Record<string, any>>(id: string | OwnModule) {\r\n    return getModule<TApi>(id)?.api as ReturnedModuleApi<TApi>\r\n}\r\n","import { MODULE_ID, TYPE } from '@utils/module'\r\n\r\nexport function getSettingLocalizationPath(...path: string[]) {\r\n    return `${MODULE_ID}.settings.${path.join('.')}`\r\n}\r\n\r\nexport function flagsUpdatePath(...path: string[]) {\r\n    return `flags.${MODULE_ID}.${path.join('/')}`\r\n}\r\n\r\nexport function templatePath(...path: string[]) {\r\n    path = path.filter(x => typeof x === 'string')\r\n    return `${TYPE}s/${MODULE_ID}/templates/${path.join('/')}`\r\n}\r\n\r\nexport function imagePath(...path: string[]) {\r\n    return `${TYPE}s/${MODULE_ID}/images/${path.join('/')}`\r\n}\r\n","import { MODULE_ID } from '@utils/module'\r\nimport { getSettingLocalizationPath } from '@utils/foundry/path'\r\n\r\nexport function getSetting<T extends any>(key: string) {\r\n    return game.settings.get(MODULE_ID, key) as T\r\n}\r\n\r\nexport function setSetting(key: string, value: unknown) {\r\n    return game.settings.set(MODULE_ID, key, value)\r\n}\r\n\r\n/**\r\n * options.scope = 'world'\r\n *\r\n * options.config = false\r\n */\r\nexport function registerSetting<TChoices extends Record<string, unknown> | undefined>(\r\n    options: Omit<SettingRegistration<TChoices>, 'choices'> & { choices?: string[] | Record<string, unknown>; name: string }\r\n) {\r\n    const name = options.name\r\n    options.scope = options.scope ?? 'world'\r\n    options.config = options.config ?? false\r\n    if (options.config) {\r\n        options.name = getSettingLocalizationPath(name, 'name')\r\n        options.hint = getSettingLocalizationPath(name, 'hint')\r\n    }\r\n    if (Array.isArray(options.choices)) {\r\n        options.choices = options.choices.reduce((choices, choice) => {\r\n            choices[choice] = getSettingLocalizationPath(name, 'choices', choice)\r\n            return choices\r\n        }, {} as Record<string, unknown>)\r\n    }\r\n    game.settings.register<TChoices>(MODULE_ID, name, options as SettingRegistration<TChoices>)\r\n}\r\n\r\n/**\r\n * options.restricted = true\r\n *\r\n * options.icon = 'fas fa-cogs'\r\n */\r\nexport function registerSettingMenu(\r\n    options: RequiredBy<Partial<Omit<SettingSubmenuConfig, 'type'>>, 'name'> & { type: ConstructorOf<FormApplication> }\r\n) {\r\n    const name = options.name\r\n    options.name = getSettingLocalizationPath('menus', name, 'name')\r\n    options.label = getSettingLocalizationPath('menus', name, 'label')\r\n    options.hint = getSettingLocalizationPath('menus', name, 'hint')\r\n    options.restricted = options.restricted ?? true\r\n    options.icon = options.icon ?? 'fas fa-cogs'\r\n    game.settings.registerMenu(MODULE_ID, name, options as SettingSubmenuConfig)\r\n}\r\n\r\nexport function getCombatTrackerConfig() {\r\n    return game.settings.get('core', 'combatTrackerConfig') as { resource: string; skipDefeated: boolean }\r\n}\r\n","import { MODULE_ID } from '@utils/module'\r\n\r\nexport function socketOn<T extends SocketPacket = SocketPacket>(callback: SocketCallback<T>) {\r\n    game.socket.on(`module.${MODULE_ID}`, callback)\r\n}\r\n\r\nexport function socketEmit<T extends SocketPacket = SocketPacket>(packet: T) {\r\n    game.socket.emit(`module.${MODULE_ID}`, packet)\r\n}\r\n","import { MODULE_ID } from '@utils/module'\r\n\r\nexport function hasModuleFlag(doc: FoundryDocument) {\r\n    return getProperty(doc, `flags.${MODULE_ID}`) !== undefined\r\n}\r\n\r\nexport function flagPath(key: string) {\r\n    return `flags.${MODULE_ID}.key`\r\n}\r\n\r\nexport function getFlag<T extends unknown>(doc: FoundryDocument, key: string): T | undefined\r\nexport function getFlag<T extends unknown>(doc: FoundryDocument, key: string, fallback: T): T\r\nexport function getFlag<T extends unknown>(doc: FoundryDocument, key: string, fallback?: T): T | undefined {\r\n    return (doc.getFlag(MODULE_ID, key) as T | undefined) ?? fallback\r\n}\r\n\r\n/**\r\n * @template {foundry.Document} T\r\n * @param {T} doc\r\n * @param {string} key\r\n * @param {any} value\r\n * @returns T\r\n */\r\nexport function setFlag(doc: FoundryDocument, key: string, value: unknown) {\r\n    return doc.setFlag(MODULE_ID, key, value)\r\n}\r\n\r\nexport function getSourceId(doc: ClientDocumentMixin) {\r\n    return doc.getFlag<ItemUUID>('core', 'sourceId')\r\n}\r\n\r\nexport function hasSourceId(doc: ClientDocumentMixin, sourceId: DocumentUUID) {\r\n    return getSourceId(doc) === sourceId\r\n}\r\n\r\nexport function includesSourceId(doc: ClientDocumentMixin, list: DocumentUUID[]) {\r\n    const sourceId = getSourceId(doc)\r\n    return sourceId ? list.includes(sourceId) : false\r\n}\r\n","export function chatUUID(uuid: string, name?: string) {\r\n    if (name) return `@UUID[${uuid}]{${name}}`\r\n    return `@UUID[${uuid}]`\r\n}\r\n\r\nexport function fakeChatUUID(name: string) {\r\n    return `<span style=\"background: #DDD;\r\n    padding: 1px 4px;\r\n    border: 1px solid var(--color-border-dark-tertiary);\r\n    border-radius: 2px;\r\n    white-space: nowrap;\r\n    word-break: break-all;\">${name}</span>`\r\n}\r\n\r\nconst RESULT_TEXT_REGEX = /@UUID\\[([\\w\\.]+)\\]/\r\nexport function documentUuidFromTableResult(result: TableResult) {\r\n    if (result.type === CONST.TABLE_RESULT_TYPES.TEXT) return RESULT_TEXT_REGEX.exec(result.text)?.[1]\r\n    if (result.type === CONST.TABLE_RESULT_TYPES.DOCUMENT) return `${result.documentCollection}.${result.documentId}`\r\n    if (result.type === CONST.TABLE_RESULT_TYPES.COMPENDIUM) return `Compendium.${result.documentCollection}.${result.documentId}`\r\n    return undefined\r\n}\r\n","import { getFlag, setFlag } from '@utils/foundry/flags'\r\nimport { localize } from '@utils/foundry/localize'\r\nimport { error, warn } from '@utils/foundry/notification'\r\nimport { chatUUID } from '@utils/foundry/uuid'\r\nimport { socketEmit } from '@utils/socket'\r\n\r\nexport async function onTradeRequest(trade: BaseTrade) {\r\n    const { sender, receiver } = trade\r\n    const senderActor = game.actors.get(sender.cid)\r\n    const receiverActor = game.actors.get(receiver.cid)\r\n\r\n    if (!senderActor || !receiverActor) {\r\n        sendTradeError(trade)\r\n        return\r\n    }\r\n\r\n    let content = `<p>${localize('trade-request.header', { sender: senderActor.name, receiver: receiverActor.name })}</p>`\r\n    content += `<p>${localize('trade-request.give', { give: chatUUID(sender.uuid) })}</p>`\r\n    content += `<p>${localize('trade-request.want', { want: chatUUID(receiver.uuid) })}</p>`\r\n    content += `<p style=\"margin-bottom: 1em;\">${localize('trade-request.accept')}</p>`\r\n\r\n    const accept = await Dialog.confirm({\r\n        title: localize('trade-request.title'),\r\n        content: await TextEditor.enrichHTML(content, { async: true }),\r\n    })\r\n\r\n    if (accept) acceptRequest(trade)\r\n    else rejectRequest(trade)\r\n}\r\n\r\nexport async function onTradeAccepted(trade: BaseTrade) {\r\n    const { sender, receiver } = trade\r\n    const senderActor = game.actors.get(sender.cid)\r\n    const receiverActor = game.actors.get(receiver.cid)\r\n\r\n    if (!senderActor || !receiverActor) {\r\n        sendTradeError(trade)\r\n        return\r\n    }\r\n\r\n    const senderActions = getFlag<HeroAction[]>(senderActor, 'heroActions') ?? []\r\n    const receiverActions = getFlag<HeroAction[]>(receiverActor, 'heroActions') ?? []\r\n\r\n    const senderActionIndex = senderActions.findIndex(x => x.uuid === sender.uuid)\r\n    const receiverActionIndex = receiverActions.findIndex(x => x.uuid === receiver.uuid)\r\n\r\n    if (senderActionIndex === -1 || receiverActionIndex === -1) {\r\n        sendTradeError(trade)\r\n        return\r\n    }\r\n\r\n    const senderAction = senderActions.splice(senderActionIndex, 1)[0]!\r\n    const receiverAction = receiverActions.splice(receiverActionIndex, 1)[0]!\r\n\r\n    senderActions.push(receiverAction)\r\n    receiverActions.push(senderAction)\r\n\r\n    setFlag(senderActor, 'heroActions', senderActions)\r\n    setFlag(receiverActor, 'heroActions', receiverActions)\r\n\r\n    let content = `<div>${localize('trade-success.offer', { offer: chatUUID(senderAction.uuid) })}</div>`\r\n    content += `<div>${localize('trade-success.receive', { receive: chatUUID(receiverAction.uuid) })}</div>`\r\n\r\n    ChatMessage.create({\r\n        flavor: `<h4 class=\"action\">${localize('trade-success.header', { name: receiverActor.name })}</h4>`,\r\n        content,\r\n        speaker: ChatMessage.getSpeaker({ actor: senderActor }),\r\n    })\r\n}\r\n\r\nexport async function onTradeRejected({ receiver }: BaseTrade) {\r\n    const actor = game.actors.get(receiver.cid)!\r\n    warn('trade-rejected', { name: actor.name }, true)\r\n}\r\n\r\nexport function onTradeError(err: string) {\r\n    error('trade-error')\r\n}\r\n\r\nexport function sendTradeRequest(trade: BaseTrade) {\r\n    if (trade.receiver.id === game.user.id) {\r\n        acceptRequest(trade)\r\n        return\r\n    }\r\n\r\n    socketEmit<TradeRequestPacket>({\r\n        ...trade,\r\n        type: 'trade-request',\r\n    })\r\n}\r\n\r\nfunction rejectRequest(trade: BaseTrade) {\r\n    if (trade.sender.id === game.user.id) {\r\n        onTradeRejected(trade)\r\n        return\r\n    }\r\n\r\n    socketEmit<TradeRejectPacket>({\r\n        ...trade,\r\n        type: 'trade-reject',\r\n    })\r\n}\r\n\r\nfunction acceptRequest(trade: BaseTrade) {\r\n    if (game.user.isGM) {\r\n        onTradeAccepted(trade)\r\n        return\r\n    }\r\n\r\n    socketEmit<TradeAcceptPacket>({\r\n        ...trade,\r\n        type: 'trade-accept',\r\n    })\r\n}\r\n\r\nfunction sendTradeError({ sender, receiver }: BaseTrade, error: TradeError = 'trade-error') {\r\n    const users = new Set([sender.id, receiver.id])\r\n\r\n    if (users.has(game.user.id)) {\r\n        users.delete(game.user.id)\r\n        onTradeError(error)\r\n    }\r\n\r\n    if (!users.size) return\r\n\r\n    socketEmit<TradeErrorPacket>({\r\n        type: 'trade-error',\r\n        users: Array.from(users),\r\n        error,\r\n    })\r\n}\r\n","import { getHeroActions } from '@src/actions'\r\nimport { sendTradeRequest } from '@src/trade'\r\nimport { getCharacterOwner } from '@utils/foundry/actor'\r\nimport { localize, subLocalize } from '@utils/foundry/localize'\r\nimport { error, warn } from '@utils/foundry/notification'\r\nimport { templatePath } from '@utils/foundry/path'\r\nimport { getFirstGM, getOwner } from '@utils/foundry/user'\r\n\r\nexport class Trade extends Application {\r\n    private _actor: CharacterPF2e\r\n    private _target?: CharacterPF2e\r\n\r\n    constructor(actor: CharacterPF2e) {\r\n        super({ id: `pf2e-hero-actions-trade-${actor.id}` })\r\n        this._actor = actor\r\n    }\r\n\r\n    static get defaultOptions(): ApplicationOptions {\r\n        return mergeObject(super.defaultOptions, {\r\n            title: localize('templates.trade.title'),\r\n            template: templatePath('trade.hbs'),\r\n            width: 600,\r\n            height: 'auto',\r\n        })\r\n    }\r\n\r\n    get actor() {\r\n        return this._actor\r\n    }\r\n\r\n    get target() {\r\n        return this._target\r\n    }\r\n\r\n    set target(value) {\r\n        if (!value) {\r\n            error('templates.trade.no-target')\r\n            return\r\n        }\r\n        if (value === this._target) return\r\n        delete this.target?.apps?.[this.appId]\r\n        this._target = value\r\n        this.render()\r\n    }\r\n\r\n    getData(options?: Partial<ApplicationOptions> | undefined): object | Promise<object> {\r\n        return mergeObject(super.getData(), {\r\n            actor: this.actor,\r\n            target: this.target,\r\n            targets: game.actors.filter(x => x.type === 'character' && x.id !== this.actor.id && x.hasPlayerOwner),\r\n            actions: getHeroActions(this.actor),\r\n            targetActions: this.target ? getHeroActions(this.target) : [],\r\n            i18n: subLocalize('templates.trade'),\r\n        })\r\n    }\r\n\r\n    activateListeners(html: JQuery<HTMLElement>): void {\r\n        super.activateListeners(html)\r\n        html.find('select[name=\"target\"]').on('change', this.#onChangeTarget.bind(this))\r\n        html.find('[data-action=\"description\"]').on('click', this.#onDescription.bind(this))\r\n        html.find('[data-action=\"trade\"]').on('click', this.#onSendTrade.bind(this))\r\n        html.find('[data-action=\"cancel\"]').on('click', () => this.close())\r\n    }\r\n\r\n    render(force?: boolean | undefined, options?: RenderOptions | undefined): this | Promise<this> {\r\n        this.actor.apps[this.appId] = this\r\n        if (this.target) this.target.apps[this.appId] = this\r\n        return super.render(force, options)\r\n    }\r\n\r\n    async close(options?: ({ force?: boolean | undefined } & Record<string, unknown>) | undefined): Promise<void> {\r\n        await super.close(options)\r\n        delete this.actor.apps?.[this.appId]\r\n        delete this.target?.apps?.[this.appId]\r\n    }\r\n\r\n    #onSendTrade() {\r\n        if (!this.target) {\r\n            warn('templates.trade.no-target')\r\n            return\r\n        }\r\n\r\n        const action = this.element.find('[name=\"action\"]:checked').val()\r\n        const target = this.element.find('[name=\"targetAction\"]:checked').val()\r\n\r\n        if (typeof action !== 'string' || typeof target !== 'string') {\r\n            warn('templates.trade.no-select')\r\n            return\r\n        }\r\n\r\n        let user = getCharacterOwner(this.target, true) ?? getOwner(this.target, true) ?? getFirstGM()\r\n        if (!user) {\r\n            warn('templates.trade.no-user')\r\n            return\r\n        }\r\n\r\n        sendTradeRequest({\r\n            sender: {\r\n                id: game.user.id,\r\n                cid: this.actor.id,\r\n                uuid: action,\r\n            },\r\n            receiver: {\r\n                id: user.id,\r\n                cid: this.target.id,\r\n                uuid: target,\r\n            },\r\n        })\r\n\r\n        this.close()\r\n    }\r\n\r\n    async #onDescription(event: JQuery.ClickEvent<any, any, HTMLElement>) {\r\n        const uuid = $(event.currentTarget).siblings('input').val() as CompendiumUUID\r\n        const entry = await fromUuid<JournalEntry>(uuid)\r\n        entry?.sheet.render(true)\r\n    }\r\n\r\n    #onChangeTarget(event: JQuery.ChangeEvent<any, any, HTMLElement>) {\r\n        const id = (event.currentTarget as HTMLSelectElement).value\r\n        this.target = game.actors.get<CharacterPF2e>(id)\r\n    }\r\n}\r\n","export function getCharacterOwner(actor: Actor, connected = false) {\r\n    if (connected) return game.users.find(x => x.active && x.character === actor)\r\n    return game.users.find(x => x.character === actor)\r\n}\r\n\r\nexport function getActorTokens(actor: Actor, linkedOnly = false) {\r\n    return game.scenes.map(scene => getActorSceneTokens(scene, actor, linkedOnly)).flat()\r\n}\r\n\r\nexport function getActorSceneTokens(scene: Scene, actor: Actor, linkedOnly = false) {\r\n    return scene.tokens.filter(token => token.actorId === actor.id && (!linkedOnly || token.actorLink))\r\n}\r\n","export function isFirstGM() {\r\n    if (!game.user.isGM) return false\r\n    const firstGM = game.users.find(user => user.active && user.isGM)\r\n    return game.user === firstGM\r\n}\r\n\r\nexport function getFirstGM() {\r\n    return game.users.find(user => user.active && user.isGM)\r\n}\r\n\r\nexport function isGM() {\r\n    const data = game.data as Game['data'] & { userId: string }\r\n    const user = data.users.find(x => x._id === data.userId)\r\n    return !!user && user.role >= CONST.USER_ROLES.GAMEMASTER\r\n}\r\n\r\nexport function getOwners(doc: FoundryDocument, connected = false) {\r\n    if (connected) return game.users.filter(x => x.active && doc.testUserPermission(x, 'OWNER'))\r\n    return game.users.filter(x => doc.testUserPermission(x, 'OWNER'))\r\n}\r\n\r\nexport function getOwner(doc: FoundryDocument, connected = false) {\r\n    if (connected) return game.users.find(x => x.active && doc.testUserPermission(x, 'OWNER'))\r\n    return game.users.find(x => doc.testUserPermission(x, 'OWNER'))\r\n}\r\n","import { Trade } from '@apps/trade'\r\nimport { getFlag, setFlag } from '@utils/foundry/flags'\r\nimport { localize } from '@utils/foundry/localize'\r\nimport { error, warn } from '@utils/foundry/notification'\r\nimport { flagsUpdatePath } from '@utils/foundry/path'\r\nimport { getSetting } from '@utils/foundry/settings'\r\nimport { chatUUID, documentUuidFromTableResult } from '@utils/foundry/uuid'\r\n\r\nconst JOURNAL_UUID = 'Compendium.pf2e.journals.JournalEntry.BSp4LUSaOmUyjBko' as const\r\nconst TABLE_UUID = 'Compendium.pf2e.rollable-tables.RollTable.zgZoI7h0XjjJrrNK' as const\r\nconst ICON = 'systems/pf2e/icons/features/feats/heroic-recovery.webp' as const\r\n\r\nasync function getTableFromUuid(uuid: string | undefined) {\r\n    if (!uuid) return undefined\r\n    const table = await fromUuid(uuid)\r\n    return table && table instanceof RollTable ? table : undefined\r\n}\r\n\r\nexport async function getDefaultCompendiumTable() {\r\n    return getTableFromUuid(TABLE_UUID) as Promise<RollTable>\r\n}\r\n\r\nexport function getDefaultWorldTable() {\r\n    return game.tables.find(x => x.getFlag('core', 'sourceId') === TABLE_UUID)\r\n}\r\n\r\nexport async function getCustomTable() {\r\n    return getTableFromUuid(getSetting('tableUUID'))\r\n}\r\n\r\nexport async function getDeckTable() {\r\n    return (await getCustomTable()) ?? getDefaultWorldTable() ?? (await getDefaultCompendiumTable())\r\n}\r\n\r\nexport function getHeroActions(actor: CharacterPF2e): HeroAction[] {\r\n    return getFlag<Array<HeroAction>>(actor, 'heroActions') ?? []\r\n}\r\n\r\nexport async function useHeroAction(actor: CharacterPF2e, uuid: string) {\r\n    const points = actor.heroPoints.value\r\n    if (points < 1) return warn('use.noPoints')\r\n\r\n    const actions = getHeroActions(actor)\r\n\r\n    const index = actions.findIndex(x => x.uuid === uuid)\r\n    if (index === -1) return\r\n\r\n    const details = await getHeroActionDetails(uuid)\r\n    if (!details) error('use.noDetails')\r\n\r\n    actions.splice(index, 1)\r\n\r\n    if (details) {\r\n        actor.update({\r\n            ['system.resources.heroPoints.value']: points - 1,\r\n            [flagsUpdatePath('heroActions')]: actions,\r\n        })\r\n\r\n        ChatMessage.create({\r\n            flavor: `<h4 class=\"action\">${localize('actions-use.header')}</h4>`,\r\n            content: `<h2>${details.name}</h2>${details.description}`,\r\n            speaker: ChatMessage.getSpeaker({ actor }),\r\n        })\r\n    } else setFlag(actor, 'heroActions', actions)\r\n}\r\n\r\nexport async function getHeroActionDetails(uuid: string) {\r\n    let document = await fromUuid<JournalEntry | JournalEntryPage>(uuid)\r\n    if (!document) return undefined\r\n\r\n    const parent = document instanceof JournalEntry ? document : document.parent\r\n    const page = document instanceof JournalEntry ? document.pages.contents[0] : document\r\n\r\n    let text = page?.text.content\r\n    if (!text) return undefined\r\n\r\n    if (parent.uuid === JOURNAL_UUID) text = text.replace(/^<p>/, '<p><strong>Trigger</strong> ')\r\n    return { name: page.name, description: text }\r\n}\r\n\r\nexport function setHeroActions(actor: CharacterPF2e, actions: HeroAction[]) {\r\n    return setFlag(actor, 'heroActions', actions)\r\n}\r\n\r\nexport function getTableSource(unique = true, table?: RollTable) {\r\n    const source = {\r\n        name: localize('table.name'),\r\n        replacement: !unique,\r\n        img: ICON,\r\n        description: localize('table.description'),\r\n        flags: {\r\n            core: {\r\n                sourceId: TABLE_UUID,\r\n            },\r\n        },\r\n    }\r\n    if (!table) return source\r\n    return mergeObject(duplicate(table._source), source)\r\n}\r\n\r\nexport async function createDefautActionsTable(unique = true) {\r\n    const table = await fromUuid<RollTable>(TABLE_UUID)\r\n    const source = getTableSource(unique, table!)\r\n    return RollTable.create(source, { temporary: false }) as Promise<RollTable>\r\n}\r\n\r\nexport function createCustomActionsTable(unique = true) {\r\n    const source = getTableSource(unique)\r\n    return RollTable.create(source, { temporary: false }) as Promise<RollTable>\r\n}\r\n\r\nexport async function drawHeroAction() {\r\n    const table = await getDeckTable()\r\n\r\n    if (!table) {\r\n        error('table.drawError', true)\r\n        return null\r\n    }\r\n\r\n    if (!table.formula) {\r\n        if (game.user.isGM) {\r\n            if (table.compendium) {\r\n                error('table.noFormulaCompendium', true)\r\n                return null\r\n            }\r\n            await table.normalize()\r\n        } else {\r\n            error('table.noFormula', true)\r\n            return null\r\n        }\r\n    }\r\n\r\n    if (table.replacement === false) {\r\n        const notDrawn = table.results.some(r => !r.drawn)\r\n        if (!notDrawn) await table.resetResults()\r\n    }\r\n\r\n    const draw = (await table.draw({ displayChat: false })).results[0]\r\n    if (!draw) return\r\n\r\n    const uuid = documentUuidFromTableResult(draw)\r\n    if (uuid) return { uuid, name: await getLabelfromTableResult(draw, uuid) }\r\n}\r\n\r\nconst RESULT_TEXT_REGEX = /@UUID\\[[\\w\\.]+\\]{([\\w -]+)}/\r\nasync function getLabelfromTableResult(result: TableResult, uuid?: string) {\r\n    if (result.type !== CONST.TABLE_RESULT_TYPES.TEXT) return result.text\r\n    const label = RESULT_TEXT_REGEX.exec(result.text)?.[1]\r\n    return label ?? (uuid && (await fromUuid(uuid as EmbeddedItemUUID))?.name)\r\n}\r\n\r\nexport async function drawHeroActions(actor: CharacterPF2e) {\r\n    const actions = getHeroActions(actor)\r\n    const nb = actor.heroPoints.value - actions.length\r\n\r\n    const drawn = /** @type {HeroAction[]} */ []\r\n    for (let i = 0; i < nb; i++) {\r\n        const action = await drawHeroAction()\r\n\r\n        if (action === undefined) continue\r\n        else if (action === null) return\r\n\r\n        actions.push(action)\r\n        drawn.push(action)\r\n    }\r\n\r\n    if (!drawn.length) return\r\n\r\n    setHeroActions(actor, actions)\r\n\r\n    const display = drawn.map(x => chatUUID(x.uuid, x.name))\r\n\r\n    const data = {\r\n        flavor: `<h4 class=\"action\">${localize('actions-draw.header', { nb: display.length })}</h4>`,\r\n        content: display.map(x => `<div>${x}</div>`).join(''),\r\n        speaker: ChatMessage.getSpeaker({ actor: actor as Actor }),\r\n    }\r\n\r\n    if (getSetting('private')) {\r\n        data.type = CONST.CHAT_MESSAGE_TYPES.ROLL\r\n        data.rollMode = CONST.DICE_ROLL_MODES.PRIVATE\r\n    }\r\n\r\n    ChatMessage.create(data)\r\n}\r\n\r\nexport async function sendActionToChat(actor: CharacterPF2e, uuid: ItemUUID) {\r\n    const details = await getHeroActionDetails(uuid)\r\n    if (!details) return error('details.missing')\r\n\r\n    ChatMessage.create({\r\n        content: `<h2>${details.name}</h2>${details.description}`,\r\n        speaker: ChatMessage.getSpeaker({ actor: actor as Actor }),\r\n    })\r\n}\r\n\r\nexport async function discardHeroActions(actor: CharacterPF2e, uuids: ItemUUID | ItemUUID[]) {\r\n    uuids = typeof uuids === 'string' ? [uuids] : uuids\r\n\r\n    const actions = getHeroActions(actor)\r\n    const removed: HeroAction[] = []\r\n\r\n    for (const uuid of uuids) {\r\n        const index = actions.findIndex(x => x.uuid === uuid)\r\n        if (index === -1) continue\r\n        removed.push(actions[index]!)\r\n        actions.splice(index, 1)\r\n    }\r\n\r\n    setHeroActions(actor, actions)\r\n\r\n    const display = removed.map(x => chatUUID(x.uuid, x.name))\r\n    ChatMessage.create({\r\n        flavor: `<h4 class=\"action\">${localize('actions-discard.header', { nb: display.length })}</h4>`,\r\n        content: display.map(x => `<div>${x}</div>`).join(''),\r\n        speaker: ChatMessage.getSpeaker({ actor: actor as Actor }),\r\n    })\r\n}\r\n\r\nexport function tradeHeroAction(actor: CharacterPF2e) {\r\n    const actions = getFlag<Array<any>>(actor, 'heroActions')\r\n    if (!actions || !actions.length) {\r\n        warn('no-action')\r\n        return\r\n    }\r\n\r\n    const diff = actions.length - actor.heroPoints.value\r\n    if (diff > 0) {\r\n        warn('no-points', { nb: diff.toString() })\r\n        return\r\n    }\r\n\r\n    new Trade(actor).render(true)\r\n}\r\n","import { setFlag } from '@utils/foundry/flags'\r\nimport { subLocalize } from '@utils/foundry/localize'\r\nimport { info, warn } from '@utils/foundry/notification'\r\nimport { templatePath } from '@utils/foundry/path'\r\nimport { setSetting } from '@utils/foundry/settings'\r\nimport { createCustomActionsTable, createDefautActionsTable, getDefaultWorldTable, getTableSource } from './actions'\r\n\r\nexport const CREATE_TABLE_UUID = 'Compendium.pf2e-hero-actions.macros.SUXi4nhdJb8vZk58'\r\n\r\nconst localizeChoice = subLocalize('templates.createTable.choice')\r\nconst localizeDefaultConfirm = subLocalize('templates.createTable.default.confirm')\r\nconst localizeRemove = subLocalize('templates.removeActions')\r\n\r\nexport async function removeHeroActions() {\r\n    const template = templatePath('dialogs/remove-actions.hbs')\r\n\r\n    const buttons: Record<string, DialogButton> = {\r\n        yes: {\r\n            label: localizeRemove('remove'),\r\n            icon: '<i class=\"fas fa-trash\"></i>',\r\n            callback: html =>\r\n                html\r\n                    .find<HTMLInputElement>('input[name=\"actor\"]:checked')\r\n                    .toArray()\r\n                    .map(x => game.actors.get(x.value))\r\n                    .filter(x => x),\r\n        },\r\n        no: {\r\n            label: localizeRemove('cancel'),\r\n            icon: '<i class=\"fas fa-times\"></i>',\r\n            callback: () => [],\r\n        },\r\n    }\r\n\r\n    const data: DialogData = {\r\n        content: await renderTemplate(template, {\r\n            actors: game.actors.filter(x => x.type === 'character'),\r\n            i18n: localizeRemove,\r\n        }),\r\n        title: localizeRemove('title'),\r\n        buttons,\r\n        default: 'yes',\r\n        render: html => {\r\n            html.on('change', 'input[name=\"all\"]', () => removeActionsToggleAll(html))\r\n            html.on('change', 'input[name=\"actor\"]', () => removeActionsToggleActor(html))\r\n        },\r\n        close: () => [],\r\n    }\r\n\r\n    const actors = await Dialog.wait(data, undefined, { id: 'pf2e-hero-actions-remove-actions' })\r\n    if (!actors.length) {\r\n        return warn('templates.removeActions.noSelection')\r\n    }\r\n\r\n    for (const actor of actors) {\r\n        await setFlag(actor, 'heroActions', [])\r\n    }\r\n\r\n    info('templates.removeActions.removed')\r\n}\r\n\r\nfunction removeActionsToggleAll(html: JQuery) {\r\n    const state = html.find<HTMLInputElement>('input[name=\"all\"]')[0]!.checked\r\n    html.find('input[name=\"actor\"]').prop('checked', state)\r\n}\r\n\r\nfunction removeActionsToggleActor(html: JQuery) {\r\n    const actors = html.find('input[name=\"actor\"]')\r\n    const checked = actors.filter(':checked')\r\n    const all = html.find('input[name=\"all\"]')\r\n\r\n    if (actors.length === checked.length) {\r\n        all.prop('checked', true).prop('indeterminate', false)\r\n        actors.prop('checked', true)\r\n    } else if (!checked.length) {\r\n        all.prop('checked', false).prop('indeterminate', false)\r\n        actors.prop('checked', false)\r\n    } else {\r\n        all.prop('checked', false).prop('indeterminate', true)\r\n    }\r\n}\r\n\r\nexport async function createTable() {\r\n    const template = templatePath('dialogs/create-table.hbs')\r\n\r\n    const buttons: Record<string, DialogButton> = {\r\n        yes: {\r\n            label: localizeChoice('create'),\r\n            icon: '<i class=\"fas fa-border-all\"></i>',\r\n            callback: html => {\r\n                const type = html.find('.window-content input[name=\"type\"]:checked').val()\r\n                const unique = html.find('.window-content input[name=\"draw\"]:checked').val() === 'unique'\r\n                return { type, unique }\r\n            },\r\n        },\r\n        no: {\r\n            label: localizeChoice('cancel'),\r\n            icon: '<i class=\"fas fa-times\"></i>',\r\n            callback: () => null,\r\n        },\r\n    }\r\n\r\n    const data: DialogData = {\r\n        content: await renderTemplate(template, { i18n: localizeChoice }),\r\n        title: localizeChoice('title'),\r\n        buttons,\r\n        default: 'yes',\r\n        close: () => null,\r\n    }\r\n\r\n    const result = await Dialog.wait(data, undefined, { id: 'pf2e-hero-actions-create-table' })\r\n    if (!result) return\r\n\r\n    if (result.type === 'default') createDefaultTable(result.unique)\r\n    else createCustomTable(result.unique)\r\n}\r\n\r\nasync function createDefaultTable(unique: boolean) {\r\n    let table = await getDefaultWorldTable()\r\n\r\n    if (table) {\r\n        const override = await Dialog.confirm({\r\n            title: localizeDefaultConfirm('title'),\r\n            content: localizeDefaultConfirm('content'),\r\n        })\r\n\r\n        if (override) {\r\n            const update = getTableSource(unique)\r\n            await table.update(update)\r\n            return setTable(table, true)\r\n        }\r\n    }\r\n\r\n    table = await createDefautActionsTable(unique)\r\n    await setTable(table)\r\n}\r\n\r\nasync function createCustomTable(unique: boolean) {\r\n    const table = await createCustomActionsTable(unique)\r\n    await setTable(table)\r\n    table.sheet?.render(true)\r\n}\r\n\r\nasync function setTable(table: RollTable, normalize = false) {\r\n    if (normalize) await table.normalize()\r\n    await setSetting('tableUUID', table.uuid)\r\n}\r\n","import { subLocalize } from '@utils/foundry/localize'\r\nimport { templatePath } from '@utils/foundry/path'\r\nimport { getSetting } from '@utils/foundry/settings'\r\nimport {\r\n    discardHeroActions,\r\n    drawHeroActions,\r\n    getHeroActionDetails,\r\n    getHeroActions,\r\n    sendActionToChat,\r\n    tradeHeroAction,\r\n    useHeroAction,\r\n} from './actions'\r\n\r\nexport async function renderCharacterSheetPF2e(sheet: CharacterSheetPF2e, $html: JQuery) {\r\n    const actor = sheet.actor\r\n    if (actor.pack || !actor.id || !game.actors.has(actor.id)) return\r\n    await addHeroActions($html, actor)\r\n    addEvents($html, actor)\r\n}\r\n\r\nasync function addHeroActions(html: JQuery, actor: CharacterPF2e) {\r\n    const actions = getHeroActions(actor)\r\n    const diff = actor.heroPoints.value - actions.length\r\n    const isOwner = actor.isOwner\r\n    const localize = subLocalize('templates.heroActions')\r\n\r\n    const template = await renderTemplate(templatePath('sheet.hbs'), {\r\n        owner: isOwner,\r\n        list: actions,\r\n        canUse: diff >= 0 && isOwner,\r\n        canDraw: diff > 0 && isOwner,\r\n        canTrade: getSetting('trade'),\r\n        mustDiscard: diff < 0,\r\n        diff: Math.abs(diff),\r\n        i18n: (key: string, { hash }: { hash: Record<string, string> }) => localize(key, hash),\r\n    })\r\n\r\n    html.find(\r\n        '.sheet-body .sheet-content [data-tab=actions] .tab-content .actions-panels [data-tab=encounter] > .strikes-list:not(.skill-action-list)'\r\n    )\r\n        .first()\r\n        .after(template)\r\n}\r\n\r\nfunction addEvents(html: JQuery, actor: CharacterPF2e) {\r\n    const $list = html.find('.tab.actions .heroActions-list')\r\n    $list.find('[data-action=draw]').on('click', event => onClickHeroActionsDraw(actor, event))\r\n    $list.find('[data-action=expand]').on('click', onClickHeroActionExpand)\r\n    $list.find('[data-action=use]').on('click', event => onClickHeroActionUse(actor, event))\r\n    $list.find('[data-action=display]').on('click', event => onClickHeroActionDisplay(actor, event))\r\n    $list.find('[data-action=discard]').on('click', onClickHeroActionDiscard)\r\n    $list.find('[data-action=discard-selected]').on('click', () => onClickHeroActionsDiscard(actor, html))\r\n    html.find('[data-action=hero-actions-trade]').on('click', () => tradeHeroAction(actor))\r\n}\r\n\r\nasync function onClickHeroActionExpand(event: JQuery.ClickEvent<any, any, HTMLElement>) {\r\n    event.preventDefault()\r\n\r\n    const $action = $(event.currentTarget).closest('.action')\r\n    const $summary = $action.find('.item-summary')\r\n\r\n    if (!$summary.hasClass('loaded')) {\r\n        const uuid = $action.attr('data-uuid')!\r\n        const details = await getHeroActionDetails(uuid)\r\n        if (!details) return\r\n\r\n        const text = await TextEditor.enrichHTML(details.description, { async: true })\r\n\r\n        $summary.find('.item-description').html(text)\r\n        $summary.addClass('loaded')\r\n    }\r\n\r\n    $action.toggleClass('expanded')\r\n}\r\n\r\nasync function onClickHeroActionDisplay(actor: CharacterPF2e, event: JQuery.ClickEvent<any, any, HTMLElement>) {\r\n    event.preventDefault()\r\n    const uuid = $(event.currentTarget).closest('.action').attr('data-uuid') as ItemUUID\r\n    sendActionToChat(actor, uuid)\r\n}\r\n\r\nfunction onClickHeroActionDiscard(event: JQuery.ClickEvent<any, any, HTMLElement>) {\r\n    event.preventDefault()\r\n\r\n    const action = $(event.currentTarget).closest('.action')\r\n    const list = action.closest('.heroActions-list')\r\n\r\n    action.toggleClass('discarded')\r\n\r\n    const toDiscard = Number(list.attr('data-discard') ?? '0')\r\n    const $discarded = list.find('.action.discarded')\r\n\r\n    list.toggleClass('discardable', $discarded.length === toDiscard)\r\n}\r\n\r\nasync function onClickHeroActionsDiscard(actor: CharacterPF2e, html: JQuery) {\r\n    const discarded = html.find('.tab.actions .heroActions-list .action.discarded')\r\n    const uuids = discarded.toArray().map(x => x.dataset.uuid) as ItemUUID[]\r\n    discardHeroActions(actor, uuids)\r\n}\r\n\r\nasync function onClickHeroActionsDraw(actor: CharacterPF2e, event: JQuery.ClickEvent) {\r\n    event.preventDefault()\r\n    drawHeroActions(actor)\r\n}\r\n\r\nasync function onClickHeroActionUse(actor: CharacterPF2e, event: JQuery.ClickEvent<any, any, HTMLElement>) {\r\n    event.preventDefault()\r\n    const uuid = $(event.currentTarget).closest('.action').attr('data-uuid')!\r\n    useHeroAction(actor, uuid)\r\n}\r\n\r\nexport function refreshSheets() {\r\n    Object.values(ui.windows).forEach(x => {\r\n        if (x instanceof ActorSheet && x.actor.type === 'character') {\r\n            x.render(true)\r\n        }\r\n    })\r\n}\r\n","import { localize } from '@utils/foundry/localize'\r\nimport { getCurrentModule } from '@utils/foundry/module'\r\nimport { getSetting, registerSetting, setSetting } from '@utils/foundry/settings'\r\nimport { isFirstGM } from '@utils/foundry/user'\r\nimport { setModuleID } from '@utils/module'\r\nimport { socketOn } from '@utils/socket'\r\nimport {\r\n    discardHeroActions,\r\n    drawHeroAction,\r\n    drawHeroActions,\r\n    getHeroActionDetails,\r\n    getHeroActions,\r\n    sendActionToChat,\r\n    tradeHeroAction,\r\n    useHeroAction,\r\n} from './actions'\r\nimport { createTable, removeHeroActions } from './api'\r\nimport { refreshSheets, renderCharacterSheetPF2e } from './sheet'\r\nimport { onTradeAccepted, onTradeError, onTradeRejected, onTradeRequest } from './trade'\r\n\r\nexport const MODULE_ID = 'pf2e-hero-actions'\r\nsetModuleID(MODULE_ID)\r\n\r\nHooks.on('renderCharacterSheetPF2e', renderCharacterSheetPF2e)\r\n\r\nHooks.once('init', () => {\r\n    registerSetting({\r\n        name: 'tableUUID',\r\n        type: String,\r\n        default: '',\r\n        config: true,\r\n    })\r\n\r\n    registerSetting({\r\n        name: 'trade',\r\n        type: Boolean,\r\n        default: false,\r\n        config: true,\r\n        onChange: refreshSheets,\r\n    })\r\n\r\n    registerSetting({\r\n        name: 'private',\r\n        type: Boolean,\r\n        default: false,\r\n        config: true,\r\n    })\r\n\r\n    registerSetting({\r\n        name: 'migrated',\r\n        type: Number,\r\n        default: 0,\r\n    })\r\n})\r\n\r\nHooks.once('ready', async () => {\r\n    socketOn(onPacketReceived)\r\n\r\n    getCurrentModule<HeroActionsApi>().api = {\r\n        getHeroActions,\r\n        useHeroAction,\r\n        getHeroActionDetails,\r\n        drawHeroAction,\r\n        drawHeroActions,\r\n        sendActionToChat,\r\n        discardHeroActions,\r\n        tradeHeroAction,\r\n    }\r\n\r\n    if (game.user.isGM) {\r\n        getCurrentModule<HeroActionsApi>().api.createTable = createTable\r\n        getCurrentModule<HeroActionsApi>().api.removeHeroActions = removeHeroActions\r\n\r\n        await manageMigrations()\r\n    }\r\n})\r\n\r\nasync function manageMigrations() {\r\n    const migrated = getSetting<number>('migrated')\r\n\r\n    // pf2e system 5.0.1\r\n    if (migrated < 1) {\r\n        ChatMessage.create({ content: localize('migration.system-change'), whisper: game.user.id })\r\n    }\r\n\r\n    setSetting('migrated', 1)\r\n}\r\n\r\nfunction onPacketReceived(packet: Packet) {\r\n    switch (packet.type) {\r\n        case 'trade-reject':\r\n            if (packet.sender.id !== game.user.id) return\r\n            onTradeRejected(packet)\r\n            break\r\n        case 'trade-accept':\r\n            if (!isFirstGM()) return\r\n            onTradeAccepted(packet)\r\n            break\r\n        case 'trade-request':\r\n            if (packet.receiver.id !== game.user.id) return\r\n            onTradeRequest(packet)\r\n            break\r\n        case 'trade-error':\r\n            if (!packet.users.includes(game.user.id)) return\r\n            onTradeError(packet.error)\r\n            break\r\n    }\r\n}\r\n"],"names":["notify","str","arg1","arg2","arg3","type","data","undefined","permanent","ui","notifications","localize","warn","args","info","error","key","game","i18n","format","subLocalize","subKey","fn","Object","defineProperties","value","enumerable","configurable","has","hasLocalization","path","localizePath","template","hash","getCurrentModule","id","modules","get","join","flagsUpdatePath","templatePath","filter","x","getSetting","settings","setSetting","set","registerSetting","options","name","scope","config","hint","Array","isArray","choices","reduce","choice","register","socketEmit","packet","socket","emit","getFlag","doc","fallback","setFlag","chatUUID","uuid","RESULT_TEXT_REGEX","async","onTradeAccepted","trade","sender","receiver","senderActor","actors","cid","receiverActor","sendTradeError","senderActions","receiverActions","senderActionIndex","findIndex","receiverActionIndex","senderAction","splice","receiverAction","push","content","offer","receive","ChatMessage","create","flavor","speaker","getSpeaker","actor","onTradeRejected","onTradeError","err","acceptRequest","user","isGM","users","Set","delete","size","from","Trade","Application","_actor","_target","constructor","super","this","defaultOptions","mergeObject","title","width","height","target","apps","appId","render","getData","targets","hasPlayerOwner","actions","getHeroActions","targetActions","activateListeners","html","find","on","bind","close","force","action","element","val","connected","active","character","getCharacterOwner","testUserPermission","getOwner","event","$","currentTarget","siblings","entry","fromUuid","sheet","JOURNAL_UUID","TABLE_UUID","ICON","getTableFromUuid","table","RollTable","getDefaultWorldTable","tables","useHeroAction","points","heroPoints","index","details","getHeroActionDetails","update","description","document","parent","JournalEntry","page","pages","contents","text","replace","setHeroActions","getTableSource","unique","source","replacement","img","flags","core","sourceId","duplicate","_source","drawHeroAction","getCustomTable","getDefaultCompendiumTable","getDeckTable","formula","compendium","normalize","results","some","r","drawn","resetResults","draw","displayChat","result","CONST","TABLE_RESULT_TYPES","TEXT","exec","DOCUMENT","documentCollection","documentId","COMPENDIUM","getLabelfromTableResult","label","drawHeroActions","nb","length","i","display","map","CHAT_MESSAGE_TYPES","ROLL","rollMode","DICE_ROLL_MODES","PRIVATE","sendActionToChat","discardHeroActions","uuids","removed","tradeHeroAction","diff","toString","localizeChoice","localizeDefaultConfirm","localizeRemove","removeHeroActions","buttons","yes","icon","callback","toArray","no","renderTemplate","default","state","checked","prop","removeActionsToggleAll","all","removeActionsToggleActor","Dialog","wait","createTable","confirm","setTable","temporary","createDefautActionsTable","createDefaultTable","createCustomActionsTable","createCustomTable","onClickHeroActionExpand","preventDefault","$action","closest","$summary","hasClass","attr","TextEditor","enrichHTML","addClass","toggleClass","onClickHeroActionDiscard","list","toDiscard","Number","$discarded","refreshSheets","values","windows","forEach","ActorSheet","onPacketReceived","firstGM","isFirstGM","give","want","rejectRequest","onTradeRequest","includes","isSystem","setModuleID","Hooks","$html","pack","isOwner","owner","canUse","canDraw","canTrade","mustDiscard","Math","abs","first","after","addHeroActions","$list","onClickHeroActionsDraw","onClickHeroActionUse","onClickHeroActionDisplay","dataset","onClickHeroActionsDiscard","addEvents","once","String","Boolean","onChange","api","whisper","manageMigrations"],"sourceRoot":""}