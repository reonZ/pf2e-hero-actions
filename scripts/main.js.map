{
  "version": 3,
  "sources": ["../src/module.js", "../src/trade.js", "../src/apps/trade.js", "../src/actions.js", "../src/sheet.js", "../src/api.js", "../src/main.js"],
  "sourcesContent": ["export const MODULE_ID = 'pf2e-hero-actions'\r\n\r\nexport function getSetting(key) {\r\n    return game.settings.get(MODULE_ID, key)\r\n}\r\n\r\nexport function setSetting(key, value) {\r\n    return game.settings.set(MODULE_ID, key, value)\r\n}\r\n\r\nexport function localize(...args) {\r\n    let [key, data] = args\r\n    key = `${MODULE_ID}.${key}`\r\n    if (data) return game.i18n.format(key, data)\r\n    return game.i18n.localize(key)\r\n}\r\n\r\nexport function socketOn(callback) {\r\n    game.socket.on(`module.${MODULE_ID}`, callback)\r\n}\r\n\r\nexport function socketEmit(packet) {\r\n    game.socket.emit(`module.${MODULE_ID}`, packet)\r\n}\r\n\r\nexport function templatePath(...path) {\r\n    path = path.filter(x => typeof x === 'string')\r\n    return `modules/${MODULE_ID}/templates/${path.join('/')}`\r\n}\r\n\r\nexport function getFlag(doc, key, fallback) {\r\n    return doc.getFlag(MODULE_ID, key) ?? fallback\r\n}\r\n\r\nexport function setFlag(doc, key, value) {\r\n    return doc.setFlag(MODULE_ID, key, value)\r\n}\r\n\r\nexport function subLocalize(subKey) {\r\n    const fn = (...args) => localize(`${subKey}.${args[0]}`, args[1])\r\n\r\n    Object.defineProperties(fn, {\r\n        warn: {\r\n            value: (...args) => warn(`${subKey}.${args[0]}`, args[1], args[2]),\r\n            enumerable: false,\r\n            configurable: false,\r\n        },\r\n        info: {\r\n            value: (...args) => info(`${subKey}.${args[0]}`, args[1], args[2]),\r\n            enumerable: false,\r\n            configurable: false,\r\n        },\r\n        error: {\r\n            value: (...args) => error(`${subKey}.${args[0]}`, args[1], args[2]),\r\n            enumerable: false,\r\n            configurable: false,\r\n        },\r\n        has: {\r\n            value: key => hasLocalization(`${subKey}.${key}`),\r\n            enumerable: false,\r\n            configurable: false,\r\n        },\r\n        path: {\r\n            value: key => localizePath(`${subKey}.${key}`),\r\n            enumerable: false,\r\n            configurable: false,\r\n        },\r\n        template: {\r\n            value: (key, { hash }) => fn(key, hash),\r\n            enumerable: false,\r\n            configurable: false,\r\n        },\r\n    })\r\n\r\n    return fn\r\n}\r\n\r\nfunction notify(str, arg1, arg2, arg3) {\r\n    const type = typeof arg1 === 'string' ? arg1 : 'info'\r\n    const data = typeof arg1 === 'object' ? arg1 : typeof arg2 === 'object' ? arg2 : undefined\r\n    const permanent = typeof arg1 === 'boolean' ? arg1 : typeof arg2 === 'boolean' ? arg2 : arg3 ?? false\r\n\r\n    ui.notifications.notify(localize(str, data), type, { permanent })\r\n}\r\n\r\nexport function warn(...args) {\r\n    const [str, arg1, arg2] = args\r\n    notify(str, 'warning', arg1, arg2)\r\n}\r\n\r\nexport function info(...args) {\r\n    const [str, arg1, arg2] = args\r\n    notify(str, 'info', arg1, arg2)\r\n}\r\n\r\nexport function error(...args) {\r\n    const [str, arg1, arg2] = args\r\n    notify(str, 'error', arg1, arg2)\r\n}\r\n\r\nexport function chatUUID(uuid, name) {\r\n    if (name) return `@UUID[${uuid}]{${name}}`\r\n    return `@UUID[${uuid}]`\r\n}\r\n\r\nconst RESULT_TEXT_REGEX = /@UUID\\[([\\w\\.]+)\\]/\r\nexport function documentUuidFromTableResult(result) {\r\n    if (result.type === CONST.TABLE_RESULT_TYPES.TEXT) return RESULT_TEXT_REGEX.exec(result.text)?.[1]\r\n    if (result.type === CONST.TABLE_RESULT_TYPES.DOCUMENT) return `${result.documentCollection}.${result.documentId}`\r\n    if (result.type === CONST.TABLE_RESULT_TYPES.COMPENDIUM) return `Compendium.${result.documentCollection}.${result.documentId}`\r\n    return undefined\r\n}\r\n\r\nexport function getCharacterOwner(actor, connected = false) {\r\n    if (connected) return game.users.find(x => x.active && x.character === actor)\r\n    return game.users.find(x => x.character === actor)\r\n}\r\n\r\nexport function getOwner(doc, connected = false) {\r\n    if (connected) return game.users.find(x => x.active && doc.testUserPermission(x, 'OWNER'))\r\n    return game.users.find(x => doc.testUserPermission(x, 'OWNER'))\r\n}\r\n\r\nexport function isFirstGM() {\r\n    return game.user === game.users.activeGM\r\n}\r\n", "import { chatUUID, error, getFlag, localize, setFlag, socketEmit, warn } from './module'\r\n\r\nexport async function onTradeRequest(trade) {\r\n    const { sender, receiver } = trade\r\n    const senderActor = game.actors.get(sender.cid)\r\n    const receiverActor = game.actors.get(receiver.cid)\r\n\r\n    if (!senderActor || !receiverActor) {\r\n        sendTradeError(trade)\r\n        return\r\n    }\r\n\r\n    let content = `<p>${localize('trade-request.header', { sender: senderActor.name, receiver: receiverActor.name })}</p>`\r\n    content += `<p>${localize('trade-request.give', { give: chatUUID(sender.uuid) })}</p>`\r\n    content += `<p>${localize('trade-request.want', { want: chatUUID(receiver.uuid) })}</p>`\r\n    content += `<p style=\"margin-bottom: 1em;\">${localize('trade-request.accept')}</p>`\r\n\r\n    const accept = await Dialog.confirm({\r\n        title: localize('trade-request.title'),\r\n        content: await TextEditor.enrichHTML(content, { async: true }),\r\n    })\r\n\r\n    if (accept) acceptRequest(trade)\r\n    else rejectRequest(trade)\r\n}\r\n\r\nexport async function onTradeAccepted(trade) {\r\n    const { sender, receiver } = trade\r\n    const senderActor = game.actors.get(sender.cid)\r\n    const receiverActor = game.actors.get(receiver.cid)\r\n\r\n    if (!senderActor || !receiverActor) {\r\n        sendTradeError(trade)\r\n        return\r\n    }\r\n\r\n    const senderActions = getFlag(senderActor, 'heroActions') ?? []\r\n    const receiverActions = getFlag(receiverActor, 'heroActions') ?? []\r\n\r\n    const senderActionIndex = senderActions.findIndex(x => x.uuid === sender.uuid)\r\n    const receiverActionIndex = receiverActions.findIndex(x => x.uuid === receiver.uuid)\r\n\r\n    if (senderActionIndex === -1 || receiverActionIndex === -1) {\r\n        sendTradeError(trade)\r\n        return\r\n    }\r\n\r\n    const senderAction = senderActions.splice(senderActionIndex, 1)[0]\r\n    const receiverAction = receiverActions.splice(receiverActionIndex, 1)[0]\r\n\r\n    senderActions.push(receiverAction)\r\n    receiverActions.push(senderAction)\r\n\r\n    setFlag(senderActor, 'heroActions', senderActions)\r\n    setFlag(receiverActor, 'heroActions', receiverActions)\r\n\r\n    const sentLink = chatUUID(senderAction.uuid)\r\n    const receivedLink = chatUUID(receiverAction.uuid)\r\n\r\n    let content = `<div style=\"line-height: 1.6\">${localize('trade-success.offer', { offer: sentLink })}</div>`\r\n    content += `<div style=\"line-height: 1.6\">${localize('trade-success.receive', { receive: receivedLink })}</div>`\r\n\r\n    ChatMessage.create({\r\n        flavor: `<h4 class=\"action\">${localize('trade-success.header', { name: receiverActor.name })}</h4>`,\r\n        content,\r\n        speaker: ChatMessage.getSpeaker({ actor: senderActor }),\r\n    })\r\n}\r\n\r\nexport function onTradeError(err) {\r\n    error('trade-error')\r\n}\r\n\r\nexport async function onTradeRejected({ receiver }) {\r\n    const actor = game.actors.get(receiver.cid)\r\n    warn('trade-rejected', { name: actor.name }, true)\r\n}\r\n\r\nexport function sendTradeRequest(trade) {\r\n    if (trade.receiver.id === game.user.id) {\r\n        acceptRequest(trade)\r\n        return\r\n    }\r\n\r\n    socketEmit({\r\n        ...trade,\r\n        type: 'trade-request',\r\n    })\r\n}\r\n\r\nfunction acceptRequest(trade) {\r\n    if (game.user.isGM) {\r\n        onTradeAccepted(trade)\r\n        return\r\n    }\r\n\r\n    socketEmit({\r\n        ...trade,\r\n        type: 'trade-accept',\r\n    })\r\n}\r\n\r\nfunction rejectRequest(trade) {\r\n    if (trade.sender.id === game.user.id) {\r\n        onTradeRejected(trade)\r\n        return\r\n    }\r\n\r\n    socketEmit({\r\n        ...trade,\r\n        type: 'trade-reject',\r\n    })\r\n}\r\n\r\nfunction sendTradeError({ sender, receiver }, error = 'trade-error') {\r\n    const users = new Set([sender.id, receiver.id])\r\n\r\n    if (users.has(game.user.id)) {\r\n        users.delete(game.user.id)\r\n        onTradeError(error)\r\n    }\r\n\r\n    if (!users.size) return\r\n\r\n    socketEmit({\r\n        type: 'trade-error',\r\n        users: Array.from(users),\r\n        error,\r\n    })\r\n}\r\n", "import { getHeroActions } from '../actions'\r\nimport { error, getCharacterOwner, getOwner, localize, subLocalize, templatePath, warn } from '../module'\r\nimport { sendTradeRequest } from '../trade'\r\n\r\nexport class Trade extends Application {\r\n    constructor(actor) {\r\n        super({ id: `pf2e-hero-actions-trade-${actor.id}` })\r\n        this._actor = actor\r\n    }\r\n\r\n    static get defaultOptions() {\r\n        return mergeObject(super.defaultOptions, {\r\n            title: localize('templates.trade.title'),\r\n            template: templatePath('trade.hbs'),\r\n            width: 600,\r\n            height: 'auto',\r\n        })\r\n    }\r\n\r\n    get actor() {\r\n        return this._actor\r\n    }\r\n\r\n    get target() {\r\n        return this._target\r\n    }\r\n\r\n    set target(value) {\r\n        if (!value) {\r\n            error('templates.trade.no-target')\r\n            return\r\n        }\r\n        if (value === this._target) return\r\n        delete this.target?.apps?.[this.appId]\r\n        this._target = value\r\n        this.render()\r\n    }\r\n\r\n    getData(options) {\r\n        return mergeObject(super.getData(), {\r\n            actor: this.actor,\r\n            target: this.target,\r\n            targets: game.actors.filter(x => x.type === 'character' && x.id !== this.actor.id && x.hasPlayerOwner),\r\n            actions: getHeroActions(this.actor),\r\n            targetActions: this.target ? getHeroActions(this.target) : [],\r\n            i18n: subLocalize('templates.trade'),\r\n        })\r\n    }\r\n\r\n    activateListeners(html) {\r\n        super.activateListeners(html)\r\n        html.find('select[name=\"target\"]').on('change', this.#onChangeTarget.bind(this))\r\n        html.find('[data-action=\"description\"]').on('click', this.#onDescription.bind(this))\r\n        html.find('[data-action=\"trade\"]').on('click', this.#onSendTrade.bind(this))\r\n        html.find('[data-action=\"cancel\"]').on('click', () => this.close())\r\n    }\r\n\r\n    render(force, options) {\r\n        this.actor.apps[this.appId] = this\r\n        if (this.target) this.target.apps[this.appId] = this\r\n        return super.render(force, options)\r\n    }\r\n\r\n    async close(options) {\r\n        await super.close(options)\r\n        delete this.actor.apps?.[this.appId]\r\n        delete this.target?.apps?.[this.appId]\r\n    }\r\n\r\n    #onSendTrade() {\r\n        if (!this.target) {\r\n            warn('templates.trade.no-target')\r\n            return\r\n        }\r\n\r\n        const action = this.element.find('[name=\"action\"]:checked').val()\r\n        const target = this.element.find('[name=\"targetAction\"]:checked').val()\r\n\r\n        if (typeof action !== 'string' || typeof target !== 'string') {\r\n            warn('templates.trade.no-select')\r\n            return\r\n        }\r\n\r\n        let user = getCharacterOwner(this.target, true) ?? getOwner(this.target, true) ?? game.users.activeGM\r\n        if (!user) {\r\n            warn('templates.trade.no-user')\r\n            return\r\n        }\r\n\r\n        sendTradeRequest({\r\n            sender: {\r\n                id: game.user.id,\r\n                cid: this.actor.id,\r\n                uuid: action,\r\n            },\r\n            receiver: {\r\n                id: user.id,\r\n                cid: this.target.id,\r\n                uuid: target,\r\n            },\r\n        })\r\n\r\n        this.close()\r\n    }\r\n\r\n    async #onDescription(event) {\r\n        const uuid = $(event.currentTarget).siblings('input').val()\r\n        const entry = await fromUuid(uuid)\r\n        entry?.sheet.render(true)\r\n    }\r\n\r\n    #onChangeTarget(event) {\r\n        const id = event.currentTarget.value\r\n        this.target = game.actors.get(id)\r\n    }\r\n}\r\n", "import { Trade } from './apps/trade'\r\nimport { MODULE_ID, chatUUID, documentUuidFromTableResult, error, getFlag, getSetting, localize, setFlag, warn } from './module'\r\n\r\nconst JOURNAL_UUID = 'Compendium.pf2e.journals.JournalEntry.BSp4LUSaOmUyjBko'\r\nexport const TABLE_UUID = 'Compendium.pf2e.rollable-tables.RollTable.zgZoI7h0XjjJrrNK'\r\n\r\nasync function getTableFromUuid(uuid) {\r\n    if (!uuid) return undefined\r\n    const table = await fromUuid(uuid)\r\n    return table && table instanceof RollTable ? table : undefined\r\n}\r\n\r\nexport async function getDefaultCompendiumTable() {\r\n    return getTableFromUuid(TABLE_UUID)\r\n}\r\n\r\nexport function getDefaultWorldTable() {\r\n    return game.tables.find(x => x.getFlag('core', 'sourceId') === TABLE_UUID)\r\n}\r\n\r\nexport async function getCustomTable() {\r\n    return getTableFromUuid(getSetting('tableUUID'))\r\n}\r\n\r\nexport async function getDeckTable() {\r\n    return (await getCustomTable()) ?? getDefaultWorldTable() ?? (await getDefaultCompendiumTable())\r\n}\r\n\r\nexport function getHeroActions(actor) {\r\n    return getFlag(actor, 'heroActions') ?? []\r\n}\r\n\r\nexport async function getHeroActionDetails(uuid) {\r\n    let document = await fromUuid(uuid)\r\n    if (!document) return undefined\r\n\r\n    const parent = document instanceof JournalEntry ? document : document.parent\r\n    const page = document instanceof JournalEntry ? document.pages.contents[0] : document\r\n\r\n    let text = page?.text.content\r\n    if (!text) return undefined\r\n\r\n    if (parent.uuid === JOURNAL_UUID) text = text.replace(/^<p>/, '<p><strong>Trigger</strong> ')\r\n    return { name: page.name, description: text }\r\n}\r\n\r\nexport async function sendActionToChat(actor, uuid) {\r\n    const details = await getHeroActionDetails(uuid)\r\n    if (!details) return error('details.missing')\r\n\r\n    ChatMessage.create({\r\n        content: `<h2>${details.name}</h2>${details.description}`,\r\n        speaker: ChatMessage.getSpeaker({ actor: actor }),\r\n    })\r\n}\r\n\r\nexport async function discardHeroActions(actor, uuids) {\r\n    uuids = typeof uuids === 'string' ? [uuids] : uuids\r\n\r\n    const actions = getHeroActions(actor)\r\n    const removed = []\r\n\r\n    for (const uuid of uuids) {\r\n        const index = actions.findIndex(x => x.uuid === uuid)\r\n        if (index === -1) continue\r\n        removed.push(actions[index])\r\n        actions.splice(index, 1)\r\n    }\r\n\r\n    setHeroActions(actor, actions)\r\n\r\n    const { content, size } = chatActions(removed)\r\n    ChatMessage.create({\r\n        flavor: `<h4 class=\"action\">${localize('actions-discard.header', { nb: size })}</h4>`,\r\n        content,\r\n        speaker: ChatMessage.getSpeaker({ actor: actor }),\r\n    })\r\n}\r\n\r\nexport function setHeroActions(actor, actions) {\r\n    return setFlag(actor, 'heroActions', actions)\r\n}\r\n\r\nexport async function drawHeroAction() {\r\n    const table = await getDeckTable()\r\n\r\n    if (!table) {\r\n        error('table.drawError', true)\r\n        return null\r\n    }\r\n\r\n    if (!table.formula) {\r\n        if (game.user.isGM) {\r\n            if (table.compendium) {\r\n                error('table.noFormulaCompendium', true)\r\n                return null\r\n            }\r\n            await table.normalize()\r\n        } else {\r\n            error('table.noFormula', true)\r\n            return null\r\n        }\r\n    }\r\n\r\n    if (table.replacement === false) {\r\n        const notDrawn = table.results.some(r => !r.drawn)\r\n        if (!notDrawn) await table.resetResults()\r\n    }\r\n\r\n    const draw = (await table.draw({ displayChat: false })).results[0]\r\n    if (!draw) return\r\n\r\n    const uuid = documentUuidFromTableResult(draw)\r\n    if (uuid) return { uuid, name: await getLabelfromTableResult(draw, uuid) }\r\n}\r\n\r\nconst RESULT_TEXT_REGEX = /@UUID\\[[\\w\\.]+\\]{([\\w -]+)}/\r\nasync function getLabelfromTableResult(result, uuid) {\r\n    if (result.type !== CONST.TABLE_RESULT_TYPES.TEXT) return result.text\r\n    const label = RESULT_TEXT_REGEX.exec(result.text)?.[1]\r\n    return label ?? (uuid && (await fromUuid(uuid))?.name)\r\n}\r\n\r\nexport async function drawHeroActions(actor) {\r\n    const actions = getHeroActions(actor)\r\n    const nb = actor.heroPoints.value - actions.length\r\n\r\n    const drawn = []\r\n    for (let i = 0; i < nb; i++) {\r\n        const action = await drawHeroAction()\r\n\r\n        if (action === undefined) continue\r\n        else if (action === null) return\r\n\r\n        actions.push(action)\r\n        drawn.push(action)\r\n    }\r\n\r\n    if (!drawn.length) return\r\n\r\n    setHeroActions(actor, actions)\r\n\r\n    const { content, size } = chatActions(drawn)\r\n    const data = {\r\n        flavor: `<h4 class=\"action\">${localize('actions-draw.header', { nb: size })}</h4>`,\r\n        content,\r\n        speaker: ChatMessage.getSpeaker({ actor: actor }),\r\n    }\r\n\r\n    if (getSetting('private')) {\r\n        data.type = CONST.CHAT_MESSAGE_TYPES.ROLL\r\n        data.rollMode = CONST.DICE_ROLL_MODES.PRIVATE\r\n    }\r\n\r\n    ChatMessage.create(data)\r\n}\r\n\r\nexport async function useHeroAction(actor, uuid) {\r\n    const points = actor.heroPoints.value\r\n    if (points < 1) return warn('use.noPoints')\r\n\r\n    const actions = getHeroActions(actor)\r\n\r\n    const index = actions.findIndex(x => x.uuid === uuid)\r\n    if (index === -1) return\r\n\r\n    const details = await getHeroActionDetails(uuid)\r\n    if (!details) error('use.noDetails')\r\n\r\n    actions.splice(index, 1)\r\n\r\n    if (details) {\r\n        actor.update({\r\n            ['system.resources.heroPoints.value']: points - 1,\r\n            [`flags.${MODULE_ID}.heroActions`]: actions,\r\n        })\r\n\r\n        ChatMessage.create({\r\n            flavor: `<h4 class=\"action\">${localize('actions-use.header')}</h4>`,\r\n            content: `<h2>${details.name}</h2>${details.description}`,\r\n            speaker: ChatMessage.getSpeaker({ actor }),\r\n        })\r\n    } else setFlag(actor, 'heroActions', actions)\r\n}\r\n\r\nexport function tradeHeroAction(actor) {\r\n    const actions = getFlag(actor, 'heroActions')\r\n    if (!actions || !actions.length) {\r\n        warn('no-action')\r\n        return\r\n    }\r\n\r\n    const diff = actions.length - actor.heroPoints.value\r\n    if (diff > 0) {\r\n        warn('no-points', { nb: diff.toString() })\r\n        return\r\n    }\r\n\r\n    new Trade(actor).render(true)\r\n}\r\n\r\nfunction chatActions(actions) {\r\n    const links = actions.map(({ uuid, name }) => chatUUID(uuid, name))\r\n    return {\r\n        content: links.map(x => `<div style=\"line-height: 1.6;\">${x}</div>`).join(''),\r\n        size: links.length,\r\n    }\r\n}\r\n", "import {\r\n    discardHeroActions,\r\n    drawHeroActions,\r\n    getHeroActionDetails,\r\n    getHeroActions,\r\n    sendActionToChat,\r\n    tradeHeroAction,\r\n    useHeroAction,\r\n} from './actions'\r\nimport { getSetting, subLocalize, templatePath } from './module'\r\n\r\nexport async function renderCharacterSheetPF2e(sheet, html) {\r\n    const actor = sheet.actor\r\n    if (actor.pack || !actor.id || !game.actors.has(actor.id)) return\r\n    await addHeroActions(html, actor)\r\n    addEvents(html, actor)\r\n}\r\n\r\nasync function addHeroActions(html, actor) {\r\n    const actions = getHeroActions(actor)\r\n    const diff = actor.heroPoints.value - actions.length\r\n    const isOwner = actor.isOwner\r\n    const localize = subLocalize('templates.heroActions')\r\n\r\n    const template = await renderTemplate(templatePath('sheet.hbs'), {\r\n        owner: isOwner,\r\n        list: actions,\r\n        canUse: diff >= 0 && isOwner,\r\n        canDraw: diff > 0 && isOwner,\r\n        canTrade: getSetting('trade'),\r\n        mustDiscard: diff < 0,\r\n        diff: Math.abs(diff),\r\n        i18n: (key, { hash }) => localize(key, hash),\r\n    })\r\n\r\n    html.find(\r\n        '.sheet-body .sheet-content [data-tab=actions] .tab-content .actions-panels [data-tab=encounter] > .strikes-list:not(.skill-action-list)'\r\n    )\r\n        .first()\r\n        .after(template)\r\n}\r\n\r\nfunction addEvents(html, actor) {\r\n    const $list = html.find('.tab.actions .heroActions-list')\r\n    $list.find('[data-action=draw]').on('click', event => onClickHeroActionsDraw(actor, event))\r\n    $list.find('[data-action=expand]').on('click', onClickHeroActionExpand)\r\n    $list.find('[data-action=use]').on('click', event => onClickHeroActionUse(actor, event))\r\n    $list.find('[data-action=display]').on('click', event => onClickHeroActionDisplay(actor, event))\r\n    $list.find('[data-action=discard]').on('click', onClickHeroActionDiscard)\r\n    $list.find('[data-action=discard-selected]').on('click', () => onClickHeroActionsDiscard(actor, html))\r\n    html.find('[data-action=hero-actions-trade]').on('click', () => tradeHeroAction(actor))\r\n}\r\n\r\nasync function onClickHeroActionExpand(event) {\r\n    event.preventDefault()\r\n\r\n    const action = $(event.currentTarget).closest('.action')\r\n    const summary = action.find('.item-summary')\r\n\r\n    if (!summary.hasClass('loaded')) {\r\n        const uuid = action.attr('data-uuid')\r\n        const details = await getHeroActionDetails(uuid)\r\n        if (!details) return\r\n\r\n        const text = await TextEditor.enrichHTML(details.description, { async: true })\r\n\r\n        summary.find('.item-description').html(text)\r\n        summary.addClass('loaded')\r\n    }\r\n\r\n    action.toggleClass('expanded')\r\n}\r\n\r\nasync function onClickHeroActionDisplay(actor, event) {\r\n    event.preventDefault()\r\n    const uuid = $(event.currentTarget).closest('.action').attr('data-uuid')\r\n    sendActionToChat(actor, uuid)\r\n}\r\n\r\nfunction onClickHeroActionDiscard(event) {\r\n    event.preventDefault()\r\n\r\n    const action = $(event.currentTarget).closest('.action')\r\n    const list = action.closest('.heroActions-list')\r\n\r\n    action.toggleClass('discarded')\r\n\r\n    const toDiscard = Number(list.attr('data-discard') ?? '0')\r\n    const $discarded = list.find('.action.discarded')\r\n\r\n    list.toggleClass('discardable', $discarded.length === toDiscard)\r\n}\r\n\r\nasync function onClickHeroActionsDiscard(actor, html) {\r\n    const discarded = html.find('.tab.actions .heroActions-list .action.discarded')\r\n    const uuids = discarded.toArray().map(x => x.dataset.uuid)\r\n    discardHeroActions(actor, uuids)\r\n}\r\n\r\nasync function onClickHeroActionsDraw(actor, event) {\r\n    event.preventDefault()\r\n    drawHeroActions(actor)\r\n}\r\n\r\nasync function onClickHeroActionUse(actor, event) {\r\n    event.preventDefault()\r\n    const uuid = $(event.currentTarget).closest('.action').attr('data-uuid')\r\n    useHeroAction(actor, uuid)\r\n}\r\n", "import { TABLE_UUID, getDefaultWorldTable } from './actions'\r\nimport { info, localize, setFlag, setSetting, subLocalize, templatePath, warn } from './module'\r\n\r\nconst ICON = 'systems/pf2e/icons/features/feats/heroic-recovery.webp'\r\n\r\nconst localizeChoice = subLocalize('templates.createTable.choice')\r\nconst localizeDefaultConfirm = subLocalize('templates.createTable.default.confirm')\r\nconst localizeRemove = subLocalize('templates.removeActions')\r\n\r\nexport async function createTable() {\r\n    const template = templatePath('dialogs/create-table.hbs')\r\n\r\n    const buttons = {\r\n        yes: {\r\n            label: localizeChoice('create'),\r\n            icon: '<i class=\"fas fa-border-all\"></i>',\r\n            callback: html => {\r\n                const type = html.find('.window-content input[name=\"type\"]:checked').val()\r\n                const unique = html.find('.window-content input[name=\"draw\"]:checked').val() === 'unique'\r\n                return { type, unique }\r\n            },\r\n        },\r\n        no: {\r\n            label: localizeChoice('cancel'),\r\n            icon: '<i class=\"fas fa-times\"></i>',\r\n            callback: () => null,\r\n        },\r\n    }\r\n\r\n    const data = {\r\n        content: await renderTemplate(template, { i18n: localizeChoice }),\r\n        title: localizeChoice('title'),\r\n        buttons,\r\n        default: 'yes',\r\n        close: () => null,\r\n    }\r\n\r\n    const result = await Dialog.wait(data, undefined, { id: 'pf2e-hero-actions-create-table' })\r\n    if (!result) return\r\n\r\n    if (result.type === 'default') createDefaultTable(result.unique)\r\n    else createCustomTable(result.unique)\r\n}\r\n\r\nexport async function removeHeroActions() {\r\n    const template = templatePath('dialogs/remove-actions.hbs')\r\n\r\n    const buttons = {\r\n        yes: {\r\n            label: localizeRemove('remove'),\r\n            icon: '<i class=\"fas fa-trash\"></i>',\r\n            callback: html =>\r\n                html\r\n                    .find('input[name=\"actor\"]:checked')\r\n                    .toArray()\r\n                    .map(x => game.actors.get(x.value))\r\n                    .filter(x => x),\r\n        },\r\n        no: {\r\n            label: localizeRemove('cancel'),\r\n            icon: '<i class=\"fas fa-times\"></i>',\r\n            callback: () => [],\r\n        },\r\n    }\r\n\r\n    const data = {\r\n        content: await renderTemplate(template, {\r\n            actors: game.actors.filter(x => x.type === 'character'),\r\n            i18n: localizeRemove,\r\n        }),\r\n        title: localizeRemove('title'),\r\n        buttons,\r\n        default: 'yes',\r\n        render: html => {\r\n            html.on('change', 'input[name=\"all\"]', () => removeActionsToggleAll(html))\r\n            html.on('change', 'input[name=\"actor\"]', () => removeActionsToggleActor(html))\r\n        },\r\n        close: () => [],\r\n    }\r\n\r\n    const actors = await Dialog.wait(data, undefined, { id: 'pf2e-hero-actions-remove-actions' })\r\n    if (!actors.length) {\r\n        return warn('templates.removeActions.noSelection')\r\n    }\r\n\r\n    for (const actor of actors) {\r\n        await setFlag(actor, 'heroActions', [])\r\n    }\r\n\r\n    info('templates.removeActions.removed')\r\n}\r\n\r\nfunction removeActionsToggleAll(html) {\r\n    const state = html.find('input[name=\"all\"]')[0].checked\r\n    html.find('input[name=\"actor\"]').prop('checked', state)\r\n}\r\n\r\nfunction removeActionsToggleActor(html) {\r\n    const actors = html.find('input[name=\"actor\"]')\r\n    const checked = actors.filter(':checked')\r\n    const all = html.find('input[name=\"all\"]')\r\n\r\n    if (actors.length === checked.length) {\r\n        all.prop('checked', true).prop('indeterminate', false)\r\n        actors.prop('checked', true)\r\n    } else if (!checked.length) {\r\n        all.prop('checked', false).prop('indeterminate', false)\r\n        actors.prop('checked', false)\r\n    } else {\r\n        all.prop('checked', false).prop('indeterminate', true)\r\n    }\r\n}\r\n\r\nasync function createDefaultTable(unique) {\r\n    let table = await getDefaultWorldTable()\r\n\r\n    if (table) {\r\n        const override = await Dialog.confirm({\r\n            title: localizeDefaultConfirm('title'),\r\n            content: localizeDefaultConfirm('content'),\r\n        })\r\n\r\n        if (override) {\r\n            const update = getTableSource(unique)\r\n            await table.update(update)\r\n            return setTable(table, true)\r\n        }\r\n    }\r\n\r\n    table = await createDefautActionsTable(unique)\r\n    await setTable(table)\r\n}\r\n\r\nasync function createCustomTable(unique) {\r\n    const table = await createCustomActionsTable(unique)\r\n    await setTable(table)\r\n    table.sheet?.render(true)\r\n}\r\n\r\nasync function setTable(table, normalize = false) {\r\n    if (normalize) await table.normalize()\r\n    await setSetting('tableUUID', table.uuid)\r\n}\r\n\r\nfunction getTableSource(unique = true, table) {\r\n    const source = {\r\n        name: localize('table.name'),\r\n        replacement: !unique,\r\n        img: ICON,\r\n        description: localize('table.description'),\r\n        flags: {\r\n            core: {\r\n                sourceId: TABLE_UUID,\r\n            },\r\n        },\r\n    }\r\n    if (!table) return source\r\n    return mergeObject(deepClone(table._source), source)\r\n}\r\n\r\nasync function createDefautActionsTable(unique = true) {\r\n    const table = await fromUuid(TABLE_UUID)\r\n    const source = getTableSource(unique, table)\r\n    return RollTable.create(source, { temporary: false })\r\n}\r\n\r\nfunction createCustomActionsTable(unique = true) {\r\n    const source = getTableSource(unique)\r\n    return RollTable.create(source, { temporary: false })\r\n}\r\n", "import { MODULE_ID, getSetting, isFirstGM, localize, setSetting, socketOn } from './module'\r\nimport { renderCharacterSheetPF2e } from './sheet'\r\nimport {\r\n    getHeroActions,\r\n    useHeroAction,\r\n    getHeroActionDetails,\r\n    drawHeroAction,\r\n    drawHeroActions,\r\n    sendActionToChat,\r\n    discardHeroActions,\r\n    tradeHeroAction,\r\n} from './actions'\r\nimport { onTradeAccepted, onTradeError, onTradeRejected, onTradeRequest } from './trade'\r\nimport { createTable, removeHeroActions } from './api'\r\n\r\nHooks.once('init', () => {\r\n    registerSetting({\r\n        name: 'tableUUID',\r\n        type: String,\r\n        default: '',\r\n    })\r\n\r\n    registerSetting({\r\n        name: 'trade',\r\n        type: Boolean,\r\n        default: false,\r\n        onChange: refreshSheets,\r\n    })\r\n\r\n    registerSetting({\r\n        name: 'private',\r\n        type: Boolean,\r\n        default: false,\r\n    })\r\n\r\n    registerSetting({\r\n        name: 'migrated',\r\n        type: Number,\r\n        default: 0,\r\n        config: false,\r\n    })\r\n})\r\n\r\nHooks.once('ready', async () => {\r\n    socketOn(onSocket)\r\n\r\n    const module = game.modules.get(MODULE_ID)\r\n\r\n    module.api = {\r\n        getHeroActions,\r\n        useHeroAction,\r\n        getHeroActionDetails,\r\n        drawHeroAction,\r\n        drawHeroActions,\r\n        sendActionToChat,\r\n        discardHeroActions,\r\n        tradeHeroAction,\r\n    }\r\n\r\n    if (game.user.isGM) {\r\n        module.api.createTable = createTable\r\n        module.api.removeHeroActions = removeHeroActions\r\n\r\n        await manageMigrations()\r\n    }\r\n})\r\n\r\nHooks.on('renderCharacterSheetPF2e', renderCharacterSheetPF2e)\r\n\r\nfunction onSocket(packet) {\r\n    switch (packet.type) {\r\n        case 'trade-reject':\r\n            if (packet.sender.id !== game.user.id) return\r\n            onTradeRejected(packet)\r\n            break\r\n        case 'trade-accept':\r\n            if (!isFirstGM()) return\r\n            onTradeAccepted(packet)\r\n            break\r\n        case 'trade-request':\r\n            if (packet.receiver.id !== game.user.id) return\r\n            onTradeRequest(packet)\r\n            break\r\n        case 'trade-error':\r\n            if (!packet.users.includes(game.user.id)) return\r\n            onTradeError(packet.error)\r\n            break\r\n    }\r\n}\r\n\r\nasync function manageMigrations() {\r\n    const migrated = getSetting('migrated') ?? 0\r\n\r\n    // pf2e system 5.0.1\r\n    if (migrated < 1) {\r\n        ChatMessage.create({ content: localize('migration.system-change'), whisper: game.user.id })\r\n    }\r\n\r\n    setSetting('migrated', 1)\r\n}\r\n\r\nfunction registerSetting(options) {\r\n    const name = options.name\r\n    options.scope = options.scope ?? 'world'\r\n    options.config = options.config ?? true\r\n    if (options.config) {\r\n        options.name = `${MODULE_ID}.settings.${name}.name`\r\n        options.hint = `${MODULE_ID}.settings.${name}.hint`\r\n    }\r\n    game.settings.register(MODULE_ID, name, options)\r\n}\r\n\r\nfunction refreshSheets() {\r\n    Object.values(ui.windows).forEach(x => {\r\n        if (x instanceof ActorSheet && x.actor.type === 'character') {\r\n            x.render(true)\r\n        }\r\n    })\r\n}\r\n"],
  "mappings": "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",
  "names": ["MODULE_ID", "getSetting", "key", "__name", "setSetting", "value", "localize", "args", "data", "socketOn", "callback", "socketEmit", "packet", "templatePath", "path", "x", "getFlag", "doc", "fallback", "setFlag", "subLocalize", "subKey", "fn", "warn", "info", "error", "hash", "notify", "str", "arg1", "arg2", "arg3", "type", "permanent", "chatUUID", "uuid", "name", "RESULT_TEXT_REGEX", "documentUuidFromTableResult", "result", "getCharacterOwner", "actor", "connected", "getOwner", "isFirstGM", "onTradeRequest", "trade", "sender", "receiver", "senderActor", "receiverActor", "sendTradeError", "content", "localize", "chatUUID", "acceptRequest", "rejectRequest", "__name", "onTradeAccepted", "senderActions", "getFlag", "receiverActions", "senderActionIndex", "x", "receiverActionIndex", "senderAction", "receiverAction", "setFlag", "sentLink", "receivedLink", "onTradeError", "err", "error", "onTradeRejected", "actor", "warn", "sendTradeRequest", "socketEmit", "users", "Trade", "actor", "localize", "templatePath", "value", "error", "options", "x", "getHeroActions", "subLocalize", "html", "#onChangeTarget", "#onDescription", "#onSendTrade", "force", "warn", "action", "target", "user", "getCharacterOwner", "getOwner", "sendTradeRequest", "event", "uuid", "id", "__name", "JOURNAL_UUID", "TABLE_UUID", "getTableFromUuid", "uuid", "table", "__name", "getDefaultCompendiumTable", "getDefaultWorldTable", "x", "getCustomTable", "getSetting", "getDeckTable", "getHeroActions", "actor", "getFlag", "getHeroActionDetails", "document", "parent", "page", "text", "sendActionToChat", "details", "error", "discardHeroActions", "uuids", "actions", "removed", "index", "setHeroActions", "content", "size", "chatActions", "localize", "setFlag", "drawHeroAction", "r", "draw", "documentUuidFromTableResult", "getLabelfromTableResult", "RESULT_TEXT_REGEX", "result", "drawHeroActions", "nb", "drawn", "i", "action", "data", "useHeroAction", "points", "warn", "MODULE_ID", "tradeHeroAction", "diff", "Trade", "links", "name", "chatUUID", "renderCharacterSheetPF2e", "sheet", "html", "actor", "addHeroActions", "addEvents", "__name", "actions", "getHeroActions", "diff", "isOwner", "localize", "subLocalize", "template", "templatePath", "getSetting", "key", "hash", "$list", "event", "onClickHeroActionsDraw", "onClickHeroActionExpand", "onClickHeroActionUse", "onClickHeroActionDisplay", "onClickHeroActionDiscard", "onClickHeroActionsDiscard", "tradeHeroAction", "action", "summary", "uuid", "details", "getHeroActionDetails", "text", "sendActionToChat", "list", "toDiscard", "$discarded", "uuids", "x", "discardHeroActions", "drawHeroActions", "useHeroAction", "ICON", "localizeChoice", "subLocalize", "localizeDefaultConfirm", "localizeRemove", "createTable", "template", "templatePath", "buttons", "html", "type", "unique", "data", "result", "createDefaultTable", "createCustomTable", "__name", "removeHeroActions", "x", "removeActionsToggleAll", "removeActionsToggleActor", "actors", "warn", "actor", "setFlag", "info", "state", "checked", "all", "table", "getDefaultWorldTable", "update", "getTableSource", "setTable", "createDefautActionsTable", "createCustomActionsTable", "normalize", "setSetting", "source", "localize", "TABLE_UUID", "registerSetting", "refreshSheets", "socketOn", "onSocket", "module", "MODULE_ID", "getHeroActions", "useHeroAction", "getHeroActionDetails", "drawHeroAction", "drawHeroActions", "sendActionToChat", "discardHeroActions", "tradeHeroAction", "createTable", "removeHeroActions", "manageMigrations", "renderCharacterSheetPF2e", "packet", "onTradeRejected", "isFirstGM", "onTradeAccepted", "onTradeRequest", "onTradeError", "__name", "getSetting", "localize", "setSetting", "options", "name", "x"]
}
